{"version":3,"sources":["../../../../../packages/platform-browser/src/security/html_sanitizer.ts"],"names":[],"mappings":"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","file":"html_sanitizer.js","sourceRoot":"","sourcesContent":["/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\n\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {isDevMode} from '@angular/core';\n\nimport {DomAdapter, getDOM} from '../dom/dom_adapter';\n\nimport {sanitizeSrcset, sanitizeUrl} from './url_sanitizer';\n/**\n * A <body> element that can be safely used to parse untrusted HTML. Lazily initialized below.\n */\nlet /** @type {?} */ inertElement: HTMLElement|null = null;\n/**\n * Lazily initialized to make sure the DOM adapter gets set before use.\n */\nlet /** @type {?} */ DOM: DomAdapter = /** @type {?} */(( null));\n/**\n * Returns an HTML element that is guaranteed to not execute code when creating elements in it.\n * @return {?}\n */\nfunction getInertElement() {\n  if (inertElement) return inertElement;\n  DOM = getDOM();\n\n  // Prefer using <template> element if supported.\n  const /** @type {?} */ templateEl = DOM.createElement('template');\n  if ('content' in templateEl) return templateEl;\n\n  const /** @type {?} */ doc = DOM.createHtmlDocument();\n  inertElement = DOM.querySelector(doc, 'body');\n  if (inertElement == null) {\n    // usually there should be only one body element in the document, but IE doesn't have any, so we\n    // need to create one.\n    const /** @type {?} */ html = DOM.createElement('html', doc);\n    inertElement = DOM.createElement('body', doc);\n    DOM.appendChild(html, inertElement);\n    DOM.appendChild(doc, html);\n  }\n  return inertElement;\n}\n/**\n * @param {?} tags\n * @return {?}\n */\nfunction tagSet(tags: string): {[k: string]: boolean} {\n  const /** @type {?} */ res: {[k: string]: boolean} = {};\n  for (const /** @type {?} */ t of tags.split(',')) res[t] = true;\n  return res;\n}\n/**\n * @param {...?} sets\n * @return {?}\n */\nfunction merge(...sets: {[k: string]: boolean}[]): {[k: string]: boolean} {\n  const /** @type {?} */ res: {[k: string]: boolean} = {};\n  for (const /** @type {?} */ s of sets) {\n    for (const /** @type {?} */ v in s) {\n      if (s.hasOwnProperty(v)) res[v] = true;\n    }\n  }\n  return res;\n}\n\n// Good source of info about elements and attributes\n// http://dev.w3.org/html5/spec/Overview.html#semantics\n// http://simon.html5.org/html-elements\n\n// Safe Void Elements - HTML5\n// http://dev.w3.org/html5/spec/Overview.html#void-elements\nconst /** @type {?} */ VOID_ELEMENTS = tagSet('area,br,col,hr,img,wbr');\n\n// Elements that you can, intentionally, leave open (and which close themselves)\n// http://dev.w3.org/html5/spec/Overview.html#optional-tags\nconst /** @type {?} */ OPTIONAL_END_TAG_BLOCK_ELEMENTS = tagSet('colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr');\nconst /** @type {?} */ OPTIONAL_END_TAG_INLINE_ELEMENTS = tagSet('rp,rt');\nconst /** @type {?} */ OPTIONAL_END_TAG_ELEMENTS =\n    merge(OPTIONAL_END_TAG_INLINE_ELEMENTS, OPTIONAL_END_TAG_BLOCK_ELEMENTS);\n\n// Safe Block Elements - HTML5\nconst /** @type {?} */ BLOCK_ELEMENTS = merge(\n    OPTIONAL_END_TAG_BLOCK_ELEMENTS,\n    tagSet(\n        'address,article,' +\n        'aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,' +\n        'h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul'));\n\n// Inline Elements - HTML5\nconst /** @type {?} */ INLINE_ELEMENTS = merge(\n    OPTIONAL_END_TAG_INLINE_ELEMENTS,\n    tagSet(\n        'a,abbr,acronym,audio,b,' +\n        'bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,' +\n        'samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video'));\n\nconst /** @type {?} */ VALID_ELEMENTS =\n    merge(VOID_ELEMENTS, BLOCK_ELEMENTS, INLINE_ELEMENTS, OPTIONAL_END_TAG_ELEMENTS);\n\n// Attributes that have href and hence need to be sanitized\nconst /** @type {?} */ URI_ATTRS = tagSet('background,cite,href,itemtype,longdesc,poster,src,xlink:href');\n\n// Attributes that have special href set hence need to be sanitized\nconst /** @type {?} */ SRCSET_ATTRS = tagSet('srcset');\n\nconst /** @type {?} */ HTML_ATTRS = tagSet(\n    'abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,' +\n    'compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,' +\n    'ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,' +\n    'scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,' +\n    'valign,value,vspace,width');\n\n// NB: This currently consciously doesn't support SVG. SVG sanitization has had several security\n// issues in the past, so it seems safer to leave it out if possible. If support for binding SVG via\n// innerHTML is required, SVG attributes should be added here.\n\n// NB: Sanitization does not allow <form> elements or other active elements (<button> etc). Those\n// can be sanitized, but they increase security surface area without a legitimate use case, so they\n// are left out here.\n\nconst /** @type {?} */ VALID_ATTRS = merge(URI_ATTRS, SRCSET_ATTRS, HTML_ATTRS);\n/**\n * SanitizingHtmlSerializer serializes a DOM fragment, stripping out any unsafe elements and unsafe\n * attributes.\n */\nclass SanitizingHtmlSerializer {\npublic sanitizedSomething = false;\nprivate buf: string[] = [];\n/**\n * @param {?} el\n * @return {?}\n */\nsanitizeChildren(el: Element): string {\n    // This cannot use a TreeWalker, as it has to run on Angular's various DOM adapters.\n    // However this code never accesses properties off of `document` before deleting its contents\n    // again, so it shouldn't be vulnerable to DOM clobbering.\n    let /** @type {?} */ current: Node = /** @type {?} */(( el.firstChild));\n    while (current) {\n      if (DOM.isElementNode(current)) {\n        this.startElement( /** @type {?} */((current as Element)));\n      } else if (DOM.isTextNode(current)) {\n        this.chars( /** @type {?} */((DOM.nodeValue(current))));\n      } else {\n        // Strip non-element, non-text nodes.\n        this.sanitizedSomething = true;\n      }\n      if (DOM.firstChild(current)) {\n        current = /** @type {?} */(( DOM.firstChild(current)));\n        continue;\n      }\n      while (current) {\n        // Leaving the element. Walk up and to the right, closing tags as we go.\n        if (DOM.isElementNode(current)) {\n          this.endElement( /** @type {?} */((current as Element)));\n        }\n\n        let /** @type {?} */ next = checkClobberedElement(current, /** @type {?} */(( DOM.nextSibling(current))));\n\n        if (next) {\n          current = next;\n          break;\n        }\n\n        current = checkClobberedElement(current, /** @type {?} */(( DOM.parentElement(current))));\n      }\n    }\n    return this.buf.join('');\n  }\n/**\n * @param {?} element\n * @return {?}\n */\n\nprivate startElement(element: Element) {\n    const /** @type {?} */ tagName = DOM.nodeName(element).toLowerCase();\n    if (!VALID_ELEMENTS.hasOwnProperty(tagName)) {\n      this.sanitizedSomething = true;\n      return;\n    }\n    this.buf.push('<');\n    this.buf.push(tagName);\n    DOM.attributeMap(element).forEach((value: string, attrName: string) => {\n      const /** @type {?} */ lower = attrName.toLowerCase();\n      if (!VALID_ATTRS.hasOwnProperty(lower)) {\n        this.sanitizedSomething = true;\n        return;\n      }\n      // TODO(martinprobst): Special case image URIs for data:image/...\n      if (URI_ATTRS[lower]) value = sanitizeUrl(value);\n      if (SRCSET_ATTRS[lower]) value = sanitizeSrcset(value);\n      this.buf.push(' ');\n      this.buf.push(attrName);\n      this.buf.push('=\"');\n      this.buf.push(encodeEntities(value));\n      this.buf.push('\"');\n    });\n    this.buf.push('>');\n  }\n/**\n * @param {?} current\n * @return {?}\n */\n\nprivate endElement(current: Element) {\n    const /** @type {?} */ tagName = DOM.nodeName(current).toLowerCase();\n    if (VALID_ELEMENTS.hasOwnProperty(tagName) && !VOID_ELEMENTS.hasOwnProperty(tagName)) {\n      this.buf.push('</');\n      this.buf.push(tagName);\n      this.buf.push('>');\n    }\n  }\n/**\n * @param {?} chars\n * @return {?}\n */\n\nprivate chars(chars: string) { this.buf.push(encodeEntities(chars)); }\n}\n\nfunction SanitizingHtmlSerializer_tsickle_Closure_declarations() {\n/** @type {?} */\nSanitizingHtmlSerializer.prototype.sanitizedSomething;\n/** @type {?} */\nSanitizingHtmlSerializer.prototype.buf;\n}\n\n/**\n * @param {?} node\n * @param {?} nextNode\n * @return {?}\n */\nfunction checkClobberedElement(node: Node, nextNode: Node): Node {\n  if (nextNode && DOM.contains(node, nextNode)) {\n    throw new Error(\n        `Failed to sanitize html because the element is clobbered: ${DOM.getOuterHTML(node)}`);\n  }\n  return nextNode;\n}\n\n// Regular Expressions for parsing tags and attributes\nconst /** @type {?} */ SURROGATE_PAIR_REGEXP = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\n// ! to ~ is the ASCII range.\nconst /** @type {?} */ NON_ALPHANUMERIC_REGEXP = /([^\\#-~ |!])/g;\n/**\n * Escapes all potentially dangerous characters, so that the\n * resulting string can be safely inserted into attribute or\n * element text.\n * @param {?} value\n * @return {?}\n */\nfunction encodeEntities(value: string) {\n  return value.replace(/&/g, '&amp;')\n      .replace(\n          SURROGATE_PAIR_REGEXP,\n          function(match: string) {\n            const /** @type {?} */ hi = match.charCodeAt(0);\n            const /** @type {?} */ low = match.charCodeAt(1);\n            return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n          })\n      .replace(\n          NON_ALPHANUMERIC_REGEXP,\n          function(match: string) { return '&#' + match.charCodeAt(0) + ';'; })\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;');\n}\n/**\n * When IE9-11 comes across an unknown namespaced attribute e.g. 'xlink:foo' it adds 'xmlns:ns1'\n * attribute to declare ns1 namespace and prefixes the attribute with 'ns1' (e.g. 'ns1:xlink:foo').\n * \n * This is undesirable since we don't want to allow any of these custom attributes. This method\n * strips them all.\n * @param {?} el\n * @return {?}\n */\nfunction stripCustomNsAttrs(el: Element) {\n  DOM.attributeMap(el).forEach((_, attrName) => {\n    if (attrName === 'xmlns:ns1' || attrName.indexOf('ns1:') === 0) {\n      DOM.removeAttribute(el, attrName);\n    }\n  });\n  for (const /** @type {?} */ n of DOM.childNodesAsList(el)) {\n    if (DOM.isElementNode(n)) stripCustomNsAttrs( /** @type {?} */((n as Element)));\n  }\n}\n/**\n * Sanitizes the given unsafe, untrusted HTML fragment, and returns HTML text that is safe to add to\n * the DOM in a browser environment.\n * @param {?} defaultDoc\n * @param {?} unsafeHtmlInput\n * @return {?}\n */\nexport function sanitizeHtml(defaultDoc: any, unsafeHtmlInput: string): string {\n  try {\n    const /** @type {?} */ containerEl = getInertElement();\n    // Make sure unsafeHtml is actually a string (TypeScript types are not enforced at runtime).\n    let /** @type {?} */ unsafeHtml = unsafeHtmlInput ? String(unsafeHtmlInput) : '';\n\n    // mXSS protection. Repeatedly parse the document to make sure it stabilizes, so that a browser\n    // trying to auto-correct incorrect HTML cannot cause formerly inert HTML to become dangerous.\n    let /** @type {?} */ mXSSAttempts = 5;\n    let /** @type {?} */ parsedHtml = unsafeHtml;\n\n    do {\n      if (mXSSAttempts === 0) {\n        throw new Error('Failed to sanitize html because the input is unstable');\n      }\n      mXSSAttempts--;\n\n      unsafeHtml = parsedHtml;\n      DOM.setInnerHTML(containerEl, unsafeHtml);\n      if (defaultDoc.documentMode) {\n        // strip custom-namespaced attributes on IE<=11\n        stripCustomNsAttrs(containerEl);\n      }\n      parsedHtml = DOM.getInnerHTML(containerEl);\n    } while (unsafeHtml !== parsedHtml);\n\n    const /** @type {?} */ sanitizer = new SanitizingHtmlSerializer();\n    const /** @type {?} */ safeHtml = sanitizer.sanitizeChildren(DOM.getTemplateContent(containerEl) || containerEl);\n\n    // Clear out the body element.\n    const /** @type {?} */ parent = DOM.getTemplateContent(containerEl) || containerEl;\n    for (const /** @type {?} */ child of DOM.childNodesAsList(parent)) {\n      DOM.removeChild(parent, child);\n    }\n\n    if (isDevMode() && sanitizer.sanitizedSomething) {\n      DOM.log('WARNING: sanitizing HTML stripped some content (see http://g.co/ng/security#xss).');\n    }\n\n    return safeHtml;\n  } catch ( /** @type {?} */e) {\n    // In case anything goes wrong, clear out inertElement to reset the entire DOM structure.\n    inertElement = null;\n    throw e;\n  }\n}\n"]}