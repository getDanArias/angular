{"version":3,"sources":["../../../../../../packages/animations/browser/src/dsl/animation_transition_factory.ts"],"names":[],"mappings":"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","file":"animation_transition_factory.js","sourceRoot":"","sourcesContent":["/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\n\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AnimationOptions, ÉµStyleData} from '@angular/animations';\n\nimport {AnimationDriver} from '../render/animation_driver';\nimport {getOrSetAsInMap} from '../render/shared';\nimport {copyObj, interpolateParams, iteratorToArray, mergeAnimationOptions} from '../util';\n\nimport {StyleAst, TransitionAst} from './animation_ast';\nimport {buildAnimationTimelines} from './animation_timeline_builder';\nimport {TransitionMatcherFn} from './animation_transition_expr';\nimport {AnimationTransitionInstruction, createTransitionInstruction} from './animation_transition_instruction';\nimport {ElementInstructionMap} from './element_instruction_map';\n\nconst /** @type {?} */ EMPTY_OBJECT = {};\nexport class AnimationTransitionFactory {\n/**\n * @param {?} _triggerName\n * @param {?} ast\n * @param {?} _stateStyles\n */\nconstructor(\nprivate _triggerName: string,\npublic ast: TransitionAst,\nprivate _stateStyles: {[stateName: string]: AnimationStateStyles}) {}\n/**\n * @param {?} currentState\n * @param {?} nextState\n * @return {?}\n */\nmatch(currentState: any, nextState: any): boolean {\n    return oneOrMoreTransitionsMatch(this.ast.matchers, currentState, nextState);\n  }\n/**\n * @param {?} stateName\n * @param {?} params\n * @param {?} errors\n * @return {?}\n */\nbuildStyles(stateName: string, params: {[key: string]: any}, errors: any[]) {\n    const /** @type {?} */ backupStateStyler = this._stateStyles['*'];\n    const /** @type {?} */ stateStyler = this._stateStyles[stateName];\n    const /** @type {?} */ backupStyles = backupStateStyler ? backupStateStyler.buildStyles(params, errors) : {};\n    return stateStyler ? stateStyler.buildStyles(params, errors) : backupStyles;\n  }\n/**\n * @param {?} driver\n * @param {?} element\n * @param {?} currentState\n * @param {?} nextState\n * @param {?=} currentOptions\n * @param {?=} nextOptions\n * @param {?=} subInstructions\n * @return {?}\n */\nbuild(\n      driver: AnimationDriver, element: any, currentState: any, nextState: any,\n      currentOptions?: AnimationOptions, nextOptions?: AnimationOptions,\n      subInstructions?: ElementInstructionMap): AnimationTransitionInstruction {\n    const /** @type {?} */ errors: any[] = [];\n\n    const /** @type {?} */ transitionAnimationParams = this.ast.options && this.ast.options.params || EMPTY_OBJECT;\n    const /** @type {?} */ currentAnimationParams = currentOptions && currentOptions.params || EMPTY_OBJECT;\n    const /** @type {?} */ currentStateStyles = this.buildStyles(currentState, currentAnimationParams, errors);\n    const /** @type {?} */ nextAnimationParams = nextOptions && nextOptions.params || EMPTY_OBJECT;\n    const /** @type {?} */ nextStateStyles = this.buildStyles(nextState, nextAnimationParams, errors);\n\n    const /** @type {?} */ queriedElements = new Set<any>();\n    const /** @type {?} */ preStyleMap = new Map<any, {[prop: string]: boolean}>();\n    const /** @type {?} */ postStyleMap = new Map<any, {[prop: string]: boolean}>();\n    const /** @type {?} */ isRemoval = nextState === 'void';\n\n    const /** @type {?} */ animationOptions = {params: {...transitionAnimationParams, ...nextAnimationParams}};\n\n    const /** @type {?} */ timelines = buildAnimationTimelines(\n        driver, element, this.ast.animation, currentStateStyles, nextStateStyles, animationOptions,\n        subInstructions, errors);\n\n    if (errors.length) {\n      return createTransitionInstruction(\n          element, this._triggerName, currentState, nextState, isRemoval, currentStateStyles,\n          nextStateStyles, [], [], preStyleMap, postStyleMap, errors);\n    }\n\n    timelines.forEach(tl => {\n      const /** @type {?} */ elm = tl.element;\n      const /** @type {?} */ preProps = getOrSetAsInMap(preStyleMap, elm, {});\n      tl.preStyleProps.forEach(prop => preProps[prop] = true);\n\n      const /** @type {?} */ postProps = getOrSetAsInMap(postStyleMap, elm, {});\n      tl.postStyleProps.forEach(prop => postProps[prop] = true);\n\n      if (elm !== element) {\n        queriedElements.add(elm);\n      }\n    });\n\n    const /** @type {?} */ queriedElementsList = iteratorToArray(queriedElements.values());\n    return createTransitionInstruction(\n        element, this._triggerName, currentState, nextState, isRemoval, currentStateStyles,\n        nextStateStyles, timelines, queriedElementsList, preStyleMap, postStyleMap);\n  }\n}\n\nfunction AnimationTransitionFactory_tsickle_Closure_declarations() {\n/** @type {?} */\nAnimationTransitionFactory.prototype._triggerName;\n/** @type {?} */\nAnimationTransitionFactory.prototype.ast;\n/** @type {?} */\nAnimationTransitionFactory.prototype._stateStyles;\n}\n\n/**\n * @param {?} matchFns\n * @param {?} currentState\n * @param {?} nextState\n * @return {?}\n */\nfunction oneOrMoreTransitionsMatch(\n    matchFns: TransitionMatcherFn[], currentState: any, nextState: any): boolean {\n  return matchFns.some(fn => fn(currentState, nextState));\n}\nexport class AnimationStateStyles {\n/**\n * @param {?} styles\n * @param {?} defaultParams\n */\nconstructor(private styles: StyleAst,\nprivate defaultParams: {[key: string]: any}) {}\n/**\n * @param {?} params\n * @param {?} errors\n * @return {?}\n */\nbuildStyles(params: {[key: string]: any}, errors: string[]): ÉµStyleData {\n    const /** @type {?} */ finalStyles: ÉµStyleData = {};\n    const /** @type {?} */ combinedParams = copyObj(this.defaultParams);\n    Object.keys(params).forEach(key => {\n      const /** @type {?} */ value = params[key];\n      if (value != null) {\n        combinedParams[key] = value;\n      }\n    });\n    this.styles.styles.forEach(value => {\n      if (typeof value !== 'string') {\n        const /** @type {?} */ styleObj = /** @type {?} */(( value as any));\n        Object.keys(styleObj).forEach(prop => {\n          let /** @type {?} */ val = styleObj[prop];\n          if (val.length > 1) {\n            val = interpolateParams(val, combinedParams, errors);\n          }\n          finalStyles[prop] = val;\n        });\n      }\n    });\n    return finalStyles;\n  }\n}\n\nfunction AnimationStateStyles_tsickle_Closure_declarations() {\n/** @type {?} */\nAnimationStateStyles.prototype.styles;\n/** @type {?} */\nAnimationStateStyles.prototype.defaultParams;\n}\n\n"]}