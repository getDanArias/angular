{"version":3,"sources":["../../../../../../../packages/platform-webworker/src/web_workers/worker/platform_location.ts"],"names":[],"mappings":"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","file":"platform_location.js","sourceRoot":"","sourcesContent":["/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes} checked by tsc\n */\n\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {LocationChangeListener, PlatformLocation} from '@angular/common';\nimport {EventEmitter, Injectable} from '@angular/core';\nimport {ClientMessageBroker, ClientMessageBrokerFactory, FnArg, UiArguments} from '../shared/client_message_broker';\nimport {MessageBus} from '../shared/message_bus';\nimport {ROUTER_CHANNEL} from '../shared/messaging_api';\nimport {LocationType, Serializer, SerializerTypes} from '../shared/serializer';\nexport class WebWorkerPlatformLocation extends PlatformLocation {\nprivate _broker: ClientMessageBroker;\nprivate _popStateListeners: Array<Function> = [];\nprivate _hashChangeListeners: Array<Function> = [];\nprivate _location: LocationType = /** @type {?} */(( null));\nprivate _channelSource: EventEmitter<Object>;\npublic initialized: Promise<any>;\nprivate initializedResolve: () => void;\n/**\n * @param {?} brokerFactory\n * @param {?} bus\n * @param {?} _serializer\n */\nconstructor(\n      brokerFactory: ClientMessageBrokerFactory, bus: MessageBus,\nprivate _serializer: Serializer) {\n    super();\n    this._broker = brokerFactory.createMessageBroker(ROUTER_CHANNEL);\n    this._channelSource = bus.from(ROUTER_CHANNEL);\n\n    this._channelSource.subscribe({\n      next: (msg: {[key: string]: any}) => {\n        let /** @type {?} */ listeners: Array<Function>|null = null;\n        if (msg.hasOwnProperty('event')) {\n          const /** @type {?} */ type: string = msg['event']['type'];\n          if (type === 'popstate') {\n            listeners = this._popStateListeners;\n          } else if (type === 'hashchange') {\n            listeners = this._hashChangeListeners;\n          }\n\n          if (listeners) {\n            // There was a popState or hashChange event, so the location object thas been updated\n            this._location = this._serializer.deserialize(msg['location'], LocationType);\n            listeners.forEach((fn: Function) => fn(msg['event']));\n          }\n        }\n      }\n    });\n    this.initialized = new Promise(res => this.initializedResolve = res);\n  }\n/**\n * \\@internal *\n * @return {?}\n */\ninit(): Promise<boolean> {\n    const /** @type {?} */ args: UiArguments = new UiArguments('getLocation');\n\n    return /** @type {?} */(( this._broker.runOnService(args, LocationType))).then(\n        (val: LocationType) => {\n          this._location = val;\n          this.initializedResolve();\n          return true;\n        },\n        err => { throw new Error(err); });\n  }\n/**\n * @return {?}\n */\ngetBaseHrefFromDOM(): string {\n    throw new Error(\n        'Attempt to get base href from DOM from WebWorker. You must either provide a value for the APP_BASE_HREF token through DI or use the hash location strategy.');\n  }\n/**\n * @param {?} fn\n * @return {?}\n */\nonPopState(fn: LocationChangeListener): void { this._popStateListeners.push(fn); }\n/**\n * @param {?} fn\n * @return {?}\n */\nonHashChange(fn: LocationChangeListener): void { this._hashChangeListeners.push(fn); }\n/**\n * @return {?}\n */\nget pathname(): string { return this._location ? /** @type {?} */(( this._location.pathname)) : '<unknown>'; }\n/**\n * @return {?}\n */\nget search(): string { return this._location ? this._location.search : '<unknown>'; }\n/**\n * @return {?}\n */\nget hash(): string { return this._location ? this._location.hash : '<unknown>'; }\n/**\n * @param {?} newPath\n * @return {?}\n */\nset pathname(newPath: string) {\n    if (this._location === null) {\n      throw new Error('Attempt to set pathname before value is obtained from UI');\n    }\n\n    this._location.pathname = newPath;\n\n    const /** @type {?} */ fnArgs = [new FnArg(newPath, SerializerTypes.PRIMITIVE)];\n    const /** @type {?} */ args = new UiArguments('setPathname', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @param {?} state\n * @param {?} title\n * @param {?} url\n * @return {?}\n */\npushState(state: any, title: string, url: string): void {\n    const /** @type {?} */ fnArgs = [\n      new FnArg(state, SerializerTypes.PRIMITIVE),\n      new FnArg(title, SerializerTypes.PRIMITIVE),\n      new FnArg(url, SerializerTypes.PRIMITIVE),\n    ];\n    const /** @type {?} */ args = new UiArguments('pushState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @param {?} state\n * @param {?} title\n * @param {?} url\n * @return {?}\n */\nreplaceState(state: any, title: string, url: string): void {\n    const /** @type {?} */ fnArgs = [\n      new FnArg(state, SerializerTypes.PRIMITIVE),\n      new FnArg(title, SerializerTypes.PRIMITIVE),\n      new FnArg(url, SerializerTypes.PRIMITIVE),\n    ];\n    const /** @type {?} */ args = new UiArguments('replaceState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @return {?}\n */\nforward(): void {\n    const /** @type {?} */ args = new UiArguments('forward');\n    this._broker.runOnService(args, null);\n  }\n/**\n * @return {?}\n */\nback(): void {\n    const /** @type {?} */ args = new UiArguments('back');\n    this._broker.runOnService(args, null);\n  }\nstatic decorators: {type: Function, args?: any[]}[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: {type: Function, args?: any[]}[]}|null)[] = () => [\n{type: ClientMessageBrokerFactory, },\n{type: MessageBus, },\n{type: Serializer, },\n];\n}\n\nfunction WebWorkerPlatformLocation_tsickle_Closure_declarations() {\n/** @type {?} */\nWebWorkerPlatformLocation.decorators;\n/**\n * @nocollapse\n * @type {?}\n */\nWebWorkerPlatformLocation.ctorParameters;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._broker;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._popStateListeners;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._hashChangeListeners;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._location;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._channelSource;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype.initialized;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype.initializedResolve;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._serializer;\n}\n\n"]}